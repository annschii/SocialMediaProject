<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/createPost.css" />
    <title>CREATE POST</title>

</head>
<body>
    <div class="secretTitle">
        <h2 class="title" onclick="window.location.href='../main.html'">secret</h2>
        <h2>secret</h2>
    </div>

    <h1>CREATE POST</h1>

    <form id="createPostForm" onsubmit="createPost(event)">
        <input class="userInput" type="text" id="postUserId" name="postUserId" placeholder="User ID" required>
        <input class="userInput" type="text" id="postText" name="postText" placeholder="Post Text" required>
        <input type="file" id="postImage" name="postImage" placeholder="Post Image" accept="image/*" required>
        <!-- <section id="btn"><button class="noselect" type="submit">Create Post</button><div id="circle"></div></section> -->
        <button class="custom-btn btn" type="submit">Create Post</button>
    </form>

<script>
        const baseUrl = 'http://localhost:5000';


        async function createPost(event) {
            event.preventDefault();
            const userId = document.getElementById('postUserId').value;
            const text = document.getElementById('postText').value;
            const imageInput = document.getElementById('postImage');
            const imageFile = imageInput.files[0];

            const formData = new FormData();
            formData.append('file', imageFile);

            const imageUploadResponse = await fetch(`${baseUrl}/images`, {
                method: 'POST',
                body: formData,
            });

            if (imageUploadResponse.ok) {
                const imageData = await imageUploadResponse.json();
                const imagePath = imageData.image_url;

                const postResponse = await fetch(`${baseUrl}/posts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: userId,
                        text: text,
                        image: imagePath,
                    }),
                });

                if (postResponse.ok) {
                    const post = await postResponse.json();
                    console.log('Created Post:', post);
                    alert('Post created successfully!');
                    searchPosts(event); // Refresh the posts list
                } else {
                    console.error('Failed to create post:', postResponse.statusText);
                }
            } else {
                console.error('Failed to upload image:', imageUploadResponse.statusText);
            }
        }


</script>
</body>
</html>